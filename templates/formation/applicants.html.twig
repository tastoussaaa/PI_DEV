{% extends 'base.html.twig' %}

{% block title %}Formation Applicants -
	{{ formation.title }}
{% endblock %}

{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('assets/css/medecin/dashboard.css') }}">
	<style>
		/* === Container and header === */

		/* ==============================
   RESSOURCES SECTION
============================== */

.ressources-section{
  background: rgba(255,255,255,.9);
  border:1px solid var(--border);
  border-radius:22px;
  padding:20px;
  box-shadow: var(--shadow2);
  margin-top:20px;
}

.ressources-section h3{
  margin:0 0 16px;
  font-weight:980;
  letter-spacing:-.3px;
}

/* list container */
.ressources-list{
  display:grid;
  gap:12px;
}

/* each resource card */
.ressource-item{
  padding:16px;
  border-radius:18px;
  border:1px solid var(--border);
  background: rgba(233,253,255,.55);
  transition:.18s ease;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.ressource-item:hover{
  transform:translateY(-4px);
  box-shadow: var(--shadow2);
}

/* text part */
.ressource-info{
  display:grid;
  gap:6px;
}

.ressource-title{
  font-weight:950;
  font-size:14px;
}

.ressource-desc{
  font-size:13px;
  color:var(--muted);
}

/* download / action button */
.ressource-action a{
  padding:8px 14px;
  border-radius:999px;
  font-weight:900;
  font-size:12px;
  text-decoration:none;
  background: linear-gradient(135deg, rgba(24,191,234,.22), rgba(168,120,255,.18));
  border:1px solid rgba(24,191,234,.25);
  transition:.18s ease;
}

.ressource-action a:hover{
  box-shadow:0 0 0 6px rgba(24,191,234,.12);
}



/* ==============================
   APPLICANTS CONTAINER
============================== */

.applicants-container{
  background: rgba(255,255,255,.9);
  border:1px solid var(--border);
  border-radius:22px;
  padding:20px;
  box-shadow: var(--shadow2);
  margin-top:20px;
}

/* ==============================
   TABS (same style logic)
============================== */

.tabs{
  display:flex;
  gap:10px;
  margin-bottom:18px;
}

.tab-button{
  flex:1;
  padding:10px 14px;
  border-radius:999px;
  border:1px solid var(--border);
  background: rgba(233,253,255,.55);
  font-weight:900;
  font-size:13px;
  cursor:pointer;
  transition:.18s ease;
}

.tab-button:hover{
  transform:translateY(-2px);
  box-shadow: var(--shadow2);
}

.tab-button.active{
  background: linear-gradient(135deg, rgba(24,191,234,.22), rgba(168,120,255,.18));
  border:1px solid rgba(24,191,234,.25);
}

/* ==============================
   TAB CONTENT
============================== */

.tab-content{
  display:none;
}

.tab-content.active{
  display:block;
}

/* ==============================
   APPLICANT CARDS
============================== */

.applicants-list{
  display:grid;
  gap:12px;
}

.applicant-card{
  padding:16px;
  border-radius:18px;
  border:1px solid var(--border);
  background: rgba(233,253,255,.55);
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:16px;
  transition:.18s ease;
}

.applicant-card:hover{
  transform:translateY(-4px);
  box-shadow: var(--shadow2);
}

.applicant-name{
  font-weight:950;
  font-size:14px;
}

.applicant-details{
  margin-top:6px;
  display:grid;
  gap:4px;
  font-size:13px;
  color:var(--muted);
}

/* ==============================
   ACTION BUTTONS
============================== */

.action-btn{
  padding:8px 14px;
  border-radius:999px;
  font-weight:900;
  font-size:12px;
  border:1px solid var(--border);
  background: rgba(255,255,255,.9);
  cursor:pointer;
  transition:.18s ease;
}

.action-btn:hover{
  box-shadow:0 0 0 6px rgba(24,191,234,.12);
}

.btn-accept{
  background: linear-gradient(135deg, rgba(24,191,234,.22), rgba(168,120,255,.18));
  border:1px solid rgba(24,191,234,.25);
}

.btn-reject{
  background: rgba(255,120,120,.18);
  border:1px solid rgba(255,120,120,.35);
}

/* ==============================
   STATUS BADGES
============================== */

.status-badge{
  padding:6px 12px;
  border-radius:999px;
  font-weight:900;
  font-size:12px;
}

.status-accepted{
  background: rgba(24,191,234,.18);
  border:1px solid rgba(24,191,234,.25);
}

.status-rejected{
  background: rgba(255,120,120,.18);
  border:1px solid rgba(255,120,120,.35);
}

/* ==============================
   EMPTY STATE
============================== */

.empty-state{
  padding:30px;
  text-align:center;
  color:var(--muted);
}

.empty-state-icon{
  font-size:32px;
  margin-bottom:10px;
}

/* ==============================
   REJECTION FORM
============================== */

.rejection-form{
  display:none;
  margin-top:10px;
  padding:12px;
  border-radius:18px;
  background: rgba(255,255,255,.9);
  border:1px solid var(--border);
}

.rejection-form.show{
  display:block;
}

.rejection-form textarea{
  width:100%;
  border-radius:14px;
  border:1px solid var(--border);
  padding:10px;
  font-family:inherit;
  resize:vertical;
  min-height:80px;
  margin-bottom:10px;
}

/* ==============================
   FORMATION HEADER (same style system)
============================== */

.formation-header{
  background: rgba(255,255,255,.9);
  border:1px solid var(--border);
  border-radius:22px;
  padding:22px;
  box-shadow: var(--shadow2);
  margin-bottom:20px;
}

.formation-header h2{
  margin:0 0 16px;
  font-weight:980;
  letter-spacing:-.4px;
}

/* formation info grid */
.formation-info{
  display:grid;
  grid-template-columns: repeat(auto-fit,minmax(180px,1fr));
  gap:12px;
}

/* info cards */
.info-item{
  background: rgba(233,253,255,.55);
  border:1px solid var(--border);
  padding:12px;
  border-radius:18px;
  font-weight:850;
  font-size:13px;
  transition:.18s ease;
}

.info-item:hover{
  transform:translateY(-3px);
  box-shadow: var(--shadow2);
}



.btn-submit{
  background: rgba(255,120,120,.18);
  border:1px solid rgba(255,120,120,.35);
}

.btn-cancel{
  background: rgba(200,200,200,.3);
  border:1px solid var(--border);
}

	</style>
{% endblock %}

{% block body %}

{% set navigation = [
    {'name': 'Dashboard', 'path': path('app_medecin_dashboard'), 'icon': 'üè†'},
    {'name': 'Consultations', 'path': path('medecin_consultations'), 'icon': 'ü©∫'},
	{'name': 'Ordonnances', 'path': path('Ordonnance_new'), 'icon': 'üíä'},
    {'name': 'Formations', 'path': path('medecin_formations'), 'icon': 'üìö'},
    {'name': 'Nouvelle Formation', 'path': path('medecin_formation_new'), 'icon': '‚ûï'}
] %}
	<div class="portal">
		{% include 'side_bar.html.twig' %}

		<main
			class="portal__main">
			<!-- Formation Header -->
			<div class="formation-header">
				<h2>{{ formation.title }}</h2>
				<div class="formation-info">
					<div class="info-item">üìÖ Start:
						{{ formation.startDate|date('d/m/Y') }}</div>
					<div class="info-item">üìÖ End:
						{{ formation.endDate|date('d/m/Y') }}</div>
					<div class="info-item">üè∑Ô∏è
						{{ formation.category }}</div>
					<div class="info-item">üë• Total Applicants:
						{{ applications.pending|length + applications.accepted|length + applications.rejected|length }}</div>
				</div>
			</div>

			<!-- Ressources Section -->
			<div class="ressources-section">
				<h3>üìÅ Ressources de la formation</h3>

				<div class="ressources-list">
					{% for ressource in formation.ressources %}
						<div class="ressource-item">

							<div class="ressource-info">
								<div class="ressource-title">
									{{ ressource.title }}
								</div>
								<div class="ressource-desc">
									{{ ressource.description }}
								</div>
							</div>

							<div class="ressource-action">
								{% if ressource.fileName %} 
								<a href="{{ asset('uploads/pdfs/' ~ ressource.fileName) }}" target="_blank" class="action-btn btn-accept">
								 üìÑ T√©l√©charger le PDF </a> 
								 {% endif %}
							</div>

						</div>
					{% else %}
						<p>Aucune ressource disponible.</p>
					{% endfor %}
				</div>
			</div>

			<br>


		<!-- Applicants Tabs -->
		<div class="applicants-container">
			<div class="tabs">
				<button class="tab-button active" onclick="showTab(event, 'pending')">‚è≥ Pending ({{ applications.pending|length }})</button>
				<button class="tab-button" onclick="showTab(event, 'accepted')">‚úÖ Accepted ({{ applications.accepted|length }})</button>
				<button class="tab-button" onclick="showTab(event, 'rejected')">‚ùå Rejected ({{ applications.rejected|length }})</button>
			</div>

			<!-- Pending -->
			<div id="pending" class="tab-content active">
				{% if applications.pending is empty %}
					<div class="empty-state">
						<div class="empty-state-icon">üì≠</div>
						<p>No pending applications</p>
					</div>
				{% else %}
					<div class="applicants-list">
						{% for application in applications.pending %}
							<div class="applicant-card">
								<div class="applicant-info">
									<div class="applicant-name">{{ application.aideSoignant.nom }}
										{{ application.aideSoignant.prenom }}</div>
									<div class="applicant-details">
										<div class="detail-item">üìß
											{{ application.aideSoignant.email }}</div>
										<div class="detail-item">üì±
											{{ application.aideSoignant.telephone }}</div>
										<div class="detail-item">üïí Applied:
											{{ application.appliedAt|date('d/m/Y H:i') }}</div>
									</div>
								</div>
								<div class="applicant-actions">
									<form method="POST" action="{{ path('medecin_accept_application', {'id': application.id}) }}">
										<button type="submit" class="action-btn btn-accept">Accept</button>
									</form>
									<button class="action-btn btn-reject" onclick="toggleRejectionForm({{ application.id }})">Reject</button>
								</div>
							</div>
							<div id="rejection-form-{{ application.id }}" class="rejection-form">
								<form method="POST" action="{{ path('medecin_reject_application', {'id': application.id}) }}">
									<textarea name="rejectionReason" placeholder="Optional: Provide rejection reason..."></textarea>
									<div class="rejection-form-actions">
										<button type="submit" class="btn-submit">Reject Application</button>
										<button type="button" class="btn-cancel" onclick="toggleRejectionForm({{ application.id }})">Cancel</button>
									</div>
								</form>
							</div>
						{% endfor %}
					</div>
				{% endif %}
			</div>

			<!-- Accepted -->
			<div id="accepted" class="tab-content">
				{% if applications.accepted is empty %}
					<div class="empty-state">
						<div class="empty-state-icon">üë•</div>
						<p>No accepted applicants yet</p>
					</div>
				{% else %}
					<div class="applicants-list">
						{% for application in applications.accepted %}
							<div class="applicant-card">
								<div class="applicant-info">
									<div class="applicant-name">{{ application.aideSoignant.nom }}
										{{ application.aideSoignant.prenom }}</div>
									<div class="applicant-details">
										<div class="detail-item">üìß
											{{ application.aideSoignant.email }}</div>
										<div class="detail-item">üì±
											{{ application.aideSoignant.telephone }}</div>
										<div class="detail-item">‚úÖ Accepted:
											{{ application.reviewedAt|date('d/m/Y H:i') }}</div>
									</div>
								</div>
								<span class="status-badge status-accepted">Accepted</span>
							</div>
						{% endfor %}
					</div>
				{% endif %}
			</div>

			<!-- Rejected -->
			<div id="rejected" class="tab-content">
				{% if applications.rejected is empty %}
					<div class="empty-state">
						<div class="empty-state-icon">üìã</div>
						<p>No rejected applicants</p>
					</div>
				{% else %}
					<div class="applicants-list">
						{% for application in applications.rejected %}
							<div class="applicant-card">
								<div class="applicant-info">
									<div class="applicant-name">{{ application.aideSoignant.nom }}
										{{ application.aideSoignant.prenom }}</div>
									<div class="applicant-details">
										<div class="detail-item">üìß
											{{ application.aideSoignant.email }}</div>
										<div class="detail-item">üì±
											{{ application.aideSoignant.telephone }}</div>
										<div class="detail-item">‚ùå Rejected:
											{{ application.reviewedAt|date('d/m/Y H:i') }}</div>
										{% if application.rejectionReason %}
											<div class="detail-item">üìù Reason:
												{{ application.rejectionReason }}</div>
										{% endif %}
									</div>
								</div>
								<span class="status-badge status-rejected">Rejected</span>
							</div>
						{% endfor %}
					</div>
				{% endif %}
			</div>
		</div>
	</main>
</div>

<script>
	function showTab(event, tabName) {
const tabContents = document.querySelectorAll('.tab-content');
tabContents.forEach(tab => tab.classList.remove('active'));

const tabButtons = document.querySelectorAll('.tab-button');
tabButtons.forEach(btn => btn.classList.remove('active'));

document.getElementById(tabName).classList.add('active');
event.currentTarget.classList.add('active');
}

function toggleRejectionForm(applicationId) {
const form = document.getElementById('rejection-form-' + applicationId);
form.classList.toggle('show');
}
</script>{% endblock %}
