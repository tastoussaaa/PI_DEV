{% extends 'base.html.twig' %}

{% block title %}{{ demande.titreD }} - Admin{% endblock %}

{% block content %}
<div class="container py-4">
    {# Navigation #}
    {% if navigation %}
    <nav style="display: flex; gap: 16px; margin-bottom: 24px; border-bottom: 1px solid #e5e7eb; padding-bottom: 16px;">
        {% for item in navigation %}
        <a href="{{ item.path }}" 
           style="padding: 8px 16px; text-decoration: none; border-radius: 6px; {% if app.request.pathinfo starts with '/admin/demandes' and item.name == 'Demandes' %}background-color: #f0f4ff; color: #2563eb; font-weight: 600;{% else %}color: #6b7280;{% endif %} transition: all 0.3s;">
            <span style="margin-right: 4px;">{{ item.icon }}</span>{{ item.name }}
        </a>
        {% endfor %}
    </nav>
    {% endif %}

    <div class="row mb-4">
        <div class="col-auto">
            <a href="{{ path('admin_demandes') }}" class="btn btn-secondary">‚Üê Retour</a>
        </div>
        <div class="col">
            <h1>{{ demande.titreD }}</h1>
            <p class="text-muted">Demande #{{ demande.id }}</p>
        </div>
    </div>

    {# Messages Flash #}
    {% if app.flashes %}
        {% for type, messages in app.flashes %}
            {% for message in messages %}
                <div class="alert alert-{{ type === 'success' ? 'success' : 'danger' }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endfor %}
    {% endif %}

    <div class="row">
        <div class="col-md-8">
            {# Informations Demande #}
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">üìã Informations de la Demande</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Patient Email:</strong>
                            <p>{{ demande.email }}</p>
                        </div>
                        <div class="col-md-6">
                            <strong>Statut:</strong>
                            <p>
                                <span class="badge bg-{{ demande.statut === 'EN_ATTENTE' ? 'warning' : demande.statut === 'ACCEPT√âE' ? 'success' : 'danger' }}">
                                    {{ demande.statut }}
                                </span>
                            </p>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Date de Cr√©ation:</strong>
                            <p>{{ demande.dateCreation ? demande.dateCreation|date('d/m/Y H:i') : '-' }}</p>
                        </div>
                        <div class="col-md-6">
                            <strong>Date D√©but Souhait√©e:</strong>
                            <p>{{ demande.dateDebutSouhaitee ? demande.dateDebutSouhaitee|date('d/m/Y') : '-' }}</p>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Date Fin Souhait√©e:</strong>
                            <p>{{ demande.dateFinSouhaitee ? demande.dateFinSouhaitee|date('d/m/Y') : '-' }}</p>
                        </div>
                        <div class="col-md-6">
                            <strong>Budget Max:</strong>
                            <p>{{ demande.budgetMax ? demande.budgetMax ~ ' DT' : '-' }}</p>
                        </div>
                    </div>

                    <div class="mb-3">
                        <strong>Description:</strong>
                        <p style="background:#f5f5f5; padding:10px; border-radius:4px;">{{ demande.descriptionBesoin }}</p>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Type de Patient:</strong>
                            <p>{{ demande.typePatient }}</p>
                        </div>
                        <div class="col-md-6">
                            <strong>Sexe:</strong>
                            <p>{{ demande.sexe ? (demande.sexe === 'M' ? 'Homme' : 'Femme') : '-' }}</p>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <strong>Lieu:</strong>
                            <p>{{ demande.lieu ?? demande.ville ?? '-' }}</p>
                        </div>
                    </div>
                </div>
            </div>

            {# Missions Li√©es #}
            {% if demande.missions|length > 0 %}
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">üéØ Missions Li√©es</h5>
                    </div>
                    <div class="table-responsive">
                        <table class="table mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>ID</th>
                                    <th>Aide-Soignant</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for mission in demande.missions %}
                                    <tr>
                                        <td>#{{ mission.id }}</td>
                                        <td>{{ mission.aide ? (mission.aide.nom ~ ' ' ~ mission.aide.prenom) : 'Non attribu√©e' }}</td>
                                        <td>
                                            <span class="badge bg-{{ mission.statut === 'ACCEPT√âE' ? 'success' : 'warning' }}">
                                                {{ mission.statut }}
                                            </span>
                                        </td>
                                        <td>
                                            <a href="{{ path('admin_missions_show', {id: mission.id}) }}" class="btn btn-sm btn-info">Voir</a>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            {% endif %}
        </div>

        <div class="col-md-4">
            {# Actions #}
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">‚öôÔ∏è Actions</h5>
                </div>
                <div class="card-body">
                    <a href="{{ path('admin_demandes_edit', {id: demande.id}) }}" class="btn btn-warning w-100 mb-2">Modifier</a>
                    
                    <form method="post" action="{{ path('admin_demandes_delete', {id: demande.id}) }}" onsubmit="return confirm('√ätes-vous s√ªr de vouloir supprimer cette demande ?');">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete-demande-' ~ demande.id) }}">
                        <button type="submit" class="btn btn-danger w-100">Supprimer</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
