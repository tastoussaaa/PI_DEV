{% extends 'base.html.twig' %}

{% block title %}Consultations{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('assets/css/medecin/dashboard.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/consultation/form.css') }}">
{% endblock %}

{% block body %}
<div class="portal">

    {% include 'side_bar.html.twig' %}

    <main class="portal__main">

        <div class="portal__top">
            <div>
                <h1 class="portal__title">Toutes les consultations</h1>
                <p class="portal__subtitle">Voir et gérer toutes les consultations du système.</p>
            </div>

            <a href="{{ path('consultation_new') }}" class="btn btn--primary">Nouvelle consultation</a>
        </div>

        <div class="portal__content">

            <div class="portal__card">
                <div style="margin-bottom:16px;display:flex;gap:12px;align-items:flex-end">
                    <form method="get" style="display:flex;gap:8px;flex:1">
                        <input type="text" name="search" placeholder="Rechercher par motif ou patient..." value="{{ search }}" style="padding:10px 12px;border:1px solid rgba(7,19,31,.10);border-radius:10px;flex:1;font-size:14px">
                        <select name="sort" style="padding:10px 12px;border:1px solid rgba(7,19,31,.10);border-radius:10px;font-size:14px">
                            <option value="date" {% if sort == 'date' %}selected{% endif %}>Plus récent en premier</option>
                            <option value="motif" {% if sort == 'motif' %}selected{% endif %}>Motif A-Z</option>
                        </select>
                        <button type="submit" class="btn btn--primary">Rechercher</button>
                        {% if search or sort != 'date' %}
                            <a href="{{ path('consultation_index') }}" class="btn btn--ghost">Réinitialiser</a>
                        {% endif %}
                    </form>
                </div>
                {% if consultations is empty %}
                    <p>Aucune consultation pour le moment.</p>
                {% else %}
                    <div class="list">
                        {% for consultation in consultations %}
                            <div class="rowItem">
                                <div>
                                    <div class="rowItem__title">{{ consultation.motif }} — {{ consultation.dateConsultation ? consultation.dateConsultation|date('Y-m-d') ~ ' ' ~ consultation.timeSlot : 'À confirmer' }}</div>
                                    <div class="rowItem__meta">
                                        Patient : {{ consultation.name }} {{ consultation.familyName }} · 
                                        Statut : 
                                        {% if consultation.status == 'pending' %}
                                            <span style="color:var(--muted)">⏳ En attente</span>
                                        {% elseif consultation.status == 'accepted' %}
                                            <span style="color:rgb(19,184,194)">✅ Accepté</span>
                                        {% else %}
                                            <span style="color:rgb(255,107,107)">❌ Refusé</span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
                                    <a href="{{ path('consultation_show', {'id': consultation.id}) }}" class="btn btn--ghost">Détails</a>
                                    <a href="{{ path('consultation_edit', {'id': consultation.id}) }}" class="btn btn--primary">Modifier</a>
                                    <form method="post" action="{{ path('consultation_delete', {'id': consultation.id}) }}">
                                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ consultation.id) }}">
                                        <button type="submit" class="btn btn--ghost" onclick="return confirm('Supprimer cette consultation ?')">Supprimer</button>
                                    </form>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

        </div>

    </main>

</div>
{% endblock %}