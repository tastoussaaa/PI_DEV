{% extends 'base.html.twig' %}

{% block title %}Gestion des formations{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('assets/css/medecin/dashboard.css') }}">
    
    {# DataTables CSS #}
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">
{% endblock %}

{% block body %}
    {% set navigation = [
        {'name': 'Formations', 'path': path('admin_formations'), 'icon': 'üìö'},
    ] %}

    <div class="portal">
        {% include 'side_bar.html.twig' %}

        <main class="portal__main">
            <div class="portal__top">
                <h1 class="portal__title">Gestion des formations</h1>
                <p class="portal__subtitle">Valider ou refuser les formations propos√©es</p>
            </div>

            <div class="box">
                <table id="formationsTable" class="portal__table display">
                    <thead>
                        <tr>
                            <th>Titre</th>
                            <th>Cat√©gorie</th>
                            <th>Date</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for formation in formations %}
                            <tr>
                                <td>{{ formation.title }}</td>
                                <td>{{ formation.category }}</td>
                                <td>{{ formation.startDate|date('d/m/Y') }}</td>
                                <td>
                                    {% if formation.statut == constant('App\\Entity\\Formation::STATUT_VALIDE') %}
                                        <span class="status status--success">Valid√©e</span>
                                    {% elseif formation.statut == constant('App\\Entity\\Formation::STATUT_REFUSE') %}
                                        <span class="status status--danger">Refus√©e</span>
                                    {% else %}
                                        <span class="status status--warning">En attente</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if formation.statut|upper == constant('App\\Entity\\Formation::STATUT_EN_ATTENTE') %}
                                        <div style="display:flex; gap:6px; flex-wrap: wrap;">
                                            <form method="post" action="{{ path('admin_formation_update_status', {id: formation.id}) }}">
                                                <input type="hidden" name="statut" value="{{ constant('App\\Entity\\Formation::STATUT_VALIDE') }}">
                                                <input type="hidden" name="_token" value="{{ csrf_token('update-status-' ~ formation.id) }}">
                                                <button class="btn btn--primary">‚úÖ Valider</button>
                                            </form>

                                            <form method="post" action="{{ path('admin_formation_update_status', {id: formation.id}) }}">
                                                <input type="hidden" name="statut" value="{{ constant('App\\Entity\\Formation::STATUT_REFUSE') }}">
                                                <input type="hidden" name="_token" value="{{ csrf_token('update-status-' ~ formation.id) }}">
                                                <button class="btn btn--danger">‚ùå Refuser</button>
                                            </form>
                                        </div>
                                    {% endif %}

                                    <a href="{{ path('admin_formation_edit', {'id': formation.id}) }}" class="btn btn--secondary">
                                        ‚úèÔ∏è Modifier
                                    </a>

                                    <a href="{{ path('admin_formation_resources', {id: formation.id}) }}" class="btn btn--secondary" style="margin-top:4px;">
                                        üìÇ Ressources
                                    </a>
                                </td>
                            </tr>
                        {% else %}
                            <tr>
                                <td colspan="5" style="text-align:center;">Aucune formation disponible</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </main>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    {# jQuery #}
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    {# DataTables JS #}
    <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#formationsTable').DataTable({
                pageLength: 5,
                lengthMenu: [5, 10, 25, 50],
                ordering: true,
                searching: true,
                responsive: true,
                language: {
                    search: "üîé Rechercher :",
                    lengthMenu: "Afficher _MENU_ formations",
                    info: "Affichage de _START_ √† _END_ sur _TOTAL_ formations",
                    infoEmpty: "Aucune formation disponible",
                    paginate: {
                        previous: "Pr√©c√©dent",
                        next: "Suivant"
                    }
                }
            });
        });
    </script>
{% endblock %}