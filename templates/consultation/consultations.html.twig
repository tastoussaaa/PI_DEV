{% extends 'base.html.twig' %}

{% block title %}Medecin – Consultations{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('assets/css/medecin/dashboard.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/consultation/form.css') }}">
{% endblock %}

{% block body %}
<div class="portal">

    <!-- SIDEBAR -->
    {% include 'side_bar.html.twig' %}

    <main class="portal__main">

        <div class="portal__top">
            <div>
                <h1 class="portal__title">Consultations</h1>
                <p class="portal__subtitle">Manage patient consultations — review, accept or decline.</p>
            </div>

            {% if context == 'medecin' %}
                <a href="{{ path('consultation_new') }}" class="btn btn--primary">New Consultation</a>
            {% endif %}
        </div>

        <div class="portal__content">

            <div class="portal__card">
                <div style="margin-bottom:16px;display:flex;gap:12px;align-items:flex-end">
                    <form method="get" style="display:flex;gap:8px;flex:1">
                        <input type="text" name="search" placeholder="Search by motif or patient..." value="{{ search }}" style="padding:10px 12px;border:1px solid rgba(7,19,31,.10);border-radius:10px;flex:1;font-size:14px">
                        <select name="sort" style="padding:10px 12px;border:1px solid rgba(7,19,31,.10);border-radius:10px;font-size:14px">
                            <option value="date" {% if sort == 'date' %}selected{% endif %}>Newest First</option>
                            <option value="motif" {% if sort == 'motif' %}selected{% endif %}>Motif A-Z</option>
                        </select>
                        <button type="submit" class="btn btn--primary">Search</button>
                        {% if search or sort != 'date' %}
                            <a href="{{ context == 'admin' ? path('admin_consultations') : path('medecin_consultations') }}" class="btn btn--ghost">Reset</a>
                        {% endif %}
                    </form>
                </div>
                {% if consultations is empty %}
                    <p>No consultations found.</p>
                {% else %}
                    <div class="list">
                        {% for consultation in consultations %}
                            <div class="rowItem">
                                <div>
                                    <div class="rowItem__title">{{ consultation.motif }} — {{ consultation.dateConsultation ? consultation.dateConsultation|date('Y-m-d H:i') : 'TBD' }}</div>
                                    <div class="rowItem__meta">
                                        Patient: {{ consultation.name }} {{ consultation.familyName }} · 
                                        Status: 
                                        {% if consultation.status == 'pending' %}
                                            <span style="color:var(--muted)">⏳ Pending</span>
                                        {% elseif consultation.status == 'accepted' %}
                                            <span style="color:rgb(19,184,194)">✅ Accepted</span>
                                        {% else %}
                                            <span style="color:rgb(255,107,107)">❌ Declined</span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
                                    <a href="{{ path('consultation_show', {'id': consultation.id}) }}" class="btn btn--ghost">Details</a>
                                    {% if consultation.status == 'pending' %}
                                        <div style="display:flex;gap:6px">
                                            <form method="post" action="{{ path('medecin_consultation_accept', {'id': consultation.id}) }}">
                                                <button type="submit" class="btn" style="background:linear-gradient(135deg,rgba(19,184,194,.22),rgba(45,230,215,.22));border:1px solid rgba(19,184,194,.30);color:var(--text);font-weight:900;padding:10px 14px;border-radius:10px">✓ Accept</button>
                                            </form>
                                            <form method="post" action="{{ path('medecin_consultation_decline', {'id': consultation.id}) }}">
                                                <button type="submit" class="btn" style="background:linear-gradient(135deg,rgba(255,107,107,.16),rgba(255,150,107,.16));border:1px solid rgba(255,107,107,.25);color:var(--text);font-weight:900;padding:10px 14px;border-radius:10px">✕ Decline</button>
                                            </form>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

        </div>

    </main>

</div>
</div>
{% endblock %}