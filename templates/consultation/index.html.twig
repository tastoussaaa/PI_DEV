{% extends 'base.html.twig' %}

{% block title %}Consultations{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('assets/css/medecin/dashboard.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/consultation/form.css') }}">
{% endblock %}

{% block body %}
<div class="portal">

    <aside class="portal__side">
        <a href="#" class="portal__brand">
            <img src="{{ asset('assets/images/logo_mini.png') }}" class="portal__logo" alt="">
            <div>
                <div class="portal__name">Aidora</div>
                <div class="portal__tag">Consultations</div>
            </div>
        </a>
    </aside>

    <main class="portal__main">

        <div class="portal__top">
            <div>
                <h1 class="portal__title">All Consultations</h1>
                <p class="portal__subtitle">View and manage all consultations in the system.</p>
            </div>

            <a href="{{ path('consultation_new') }}" class="btn btn--primary">New Consultation</a>
        </div>

        <div class="portal__content">

            <div class="portal__card">
                <div style="margin-bottom:16px;display:flex;gap:12px;align-items:flex-end">
                    <form method="get" style="display:flex;gap:8px;flex:1">
                        <input type="text" name="search" placeholder="Search by motif or patient..." value="{{ search }}" style="padding:10px 12px;border:1px solid rgba(7,19,31,.10);border-radius:10px;flex:1;font-size:14px">
                        <select name="sort" style="padding:10px 12px;border:1px solid rgba(7,19,31,.10);border-radius:10px;font-size:14px">
                            <option value="date" {% if sort == 'date' %}selected{% endif %}>Newest First</option>
                            <option value="motif" {% if sort == 'motif' %}selected{% endif %}>Motif A-Z</option>
                        </select>
                        <button type="submit" class="btn btn--primary">Search</button>
                        {% if search or sort != 'date' %}
                            <a href="{{ path('consultation_index') }}" class="btn btn--ghost">Reset</a>
                        {% endif %}
                    </form>
                </div>
                {% if consultations is empty %}
                    <p>No consultations yet.</p>
                {% else %}
                    <div class="list">
                        {% for consultation in consultations %}
                            <div class="rowItem">
                                <div>
                                    <div class="rowItem__title">{{ consultation.motif }} — {{ consultation.dateConsultation ? consultation.dateConsultation|date('Y-m-d H:i') : 'TBD' }}</div>
                                    <div class="rowItem__meta">
                                        Patient: {{ consultation.name }} {{ consultation.familyName }} · 
                                        Status: 
                                        {% if consultation.status == 'pending' %}
                                            <span style="color:var(--muted)">⏳ Pending</span>
                                        {% elseif consultation.status == 'accepted' %}
                                            <span style="color:rgb(19,184,194)">✅ Accepted</span>
                                        {% else %}
                                            <span style="color:rgb(255,107,107)">❌ Declined</span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
                                    <a href="{{ path('consultation_show', {'id': consultation.id}) }}" class="btn btn--ghost">Details</a>
                                    <a href="{{ path('consultation_edit', {'id': consultation.id}) }}" class="btn btn--primary">Edit</a>
                                    <form method="post" action="{{ path('consultation_delete', {'id': consultation.id}) }}">
                                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ consultation.id) }}">
                                        <button type="submit" class="btn btn--ghost" onclick="return confirm('Delete this consultation?')">Delete</button>
                                    </form>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

        </div>

    </main>

</div>
{% endblock %}