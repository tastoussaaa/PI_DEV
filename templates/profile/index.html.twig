{% extends 'base.html.twig' %}

{% block title %}Mon Profil{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('assets/css/medecin/dashboard.css') }}">
{% endblock %}

{% block javascripts %}
    <script src="{{ asset('public/assets/js/controle.js') }}" defer></script>
{% endblock %}

{% block body %}
{% set dashboardRoute = current_user_type == 'aidesoignant' ? 'app_aide_soignant_dashboard' : ('app_' ~ current_user_type ~ '_dashboard') %}
{% set navigation = [
    {'name': 'Dashboard', 'path': path(dashboardRoute), 'icon': 'üè†'},
    {'name': 'Mon Profil', 'path': path('profile_index'), 'icon': 'üë§'},
] %}

<div class="portal">
    {% include 'side_bar.html.twig' %}

    <main class="portal__main">
        <div class="portal__top">
            <div>
                <h1 class="portal__title">Mon Profil</h1>
                <p class="portal__subtitle">Consultez vos informations personnelles</p>
            </div>
            <a href="{{ path('profile_edit') }}" class="btn btn--primary">
                ‚úèÔ∏è Modifier le profil
            </a>
        </div>

        <div class="portal__content">
            <div class="box">
                <h3>üë§ Informations Personnelles</h3>
                
                <div class="profile-info">
                    <div class="profile-info-item">
                        <div class="profile-info-label">Nom complet</div>
                        <div class="profile-info-value">{{ current_user.fullName }}</div>
                    </div>

                    <div class="profile-info-item">
                        <div class="profile-info-label">Email</div>
                        <div class="profile-info-value">{{ current_user.email }}</div>
                    </div>

                    <div class="profile-info-item">
                        <div class="profile-info-label">Type de compte</div>
                        <div class="profile-info-value">
                            {% if is_medecin %}
                                <span class="status-active">üè• M√©decin</span>
                            {% elseif is_patient %}
                                <span class="status-active">üë§ Patient</span>
                            {% elseif is_aide_soignant %}
                                <span class="status-active">ü©∫ Aide-Soignant</span>
                            {% else %}
                                <span class="status-active">üë§ Utilisateur</span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                {% if is_medecin and userEntity %}
                <div class="profile-info" style="border-top: 2px solid var(--border-color); padding-top: 2rem; margin-top: 2rem;">
                    <h4 style="color: var(--primary-color); margin-bottom: 1.5rem;">
                        üè• Informations Professionnelles
                    </h4>
                    
                    <div class="profile-info-item">
                        <div class="profile-info-label">Sp√©cialit√©</div>
                        <div class="profile-info-value">{{ userEntity.specialite ?? 'Non sp√©cifi√©e' }}</div>
                    </div>

                    {% if userEntity.rpps %}
                    <div class="profile-info-item">
                        <div class="profile-info-label">Num√©ro RPPS</div>
                        <div class="profile-info-value">{{ userEntity.rpps }}</div>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                {% if is_patient and userEntity %}
                <div class="profile-info" style="border-top: 2px solid var(--border-color); padding-top: 2rem; margin-top: 2rem;">
                    <h4 style="color: var(--primary-color); margin-bottom: 1.5rem;">
                        üè• Informations de Sant√©
                    </h4>
                    
                    {% if userEntity.birthDate %}
                    <div class="profile-info-item">
                        <div class="profile-info-label">Date de naissance</div>
                        <div class="profile-info-value">{{ userEntity.birthDate|date('d/m/Y') }}</div>
                    </div>
                    {% endif %}

                    {% if userEntity.ssn %}
                    <div class="profile-info-item">
                        <div class="profile-info-label">Num√©ro de s√©curit√© sociale</div>
                        <div class="profile-info-value">{{ userEntity.ssn }}</div>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                {% if is_aide_soignant and userEntity %}
                <div class="profile-info" style="border-top: 2px solid var(--border-color); padding-top: 2rem; margin-top: 2rem;">
                    <h4 style="color: var(--primary-color); margin-bottom: 1.5rem;">
                        ü©∫ Informations Professionnelles
                    </h4>
                    
                    {% if userEntity.adeli %}
                    <div class="profile-info-item">
                        <div class="profile-info-label">Num√©ro ADELI</div>
                        <div class="profile-info-value">{{ userEntity.adeli }}</div>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <!-- Zone de danger -->
                <div class="danger-zone">
                    <h4>‚ö†Ô∏è Zone de Danger</h4>
                    <p>La suppression de votre profil est irr√©versible. Toutes vos donn√©es seront d√©finitivement effac√©es.</p>
                    
                    <button type="button" onclick="openDeleteModal()" class="btn btn--danger">
                        üóëÔ∏è Supprimer mon profil
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal de confirmation de suppression -->
    <div id="deleteModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>‚ö†Ô∏è Confirmer la suppression</h3>
            <p>√ätes-vous s√ªr de vouloir supprimer votre profil ? Cette action est irr√©versible.</p>
            
            <form method="post" action="{{ path('profile_delete') }}">
                <input type="hidden" name="_token" value="{{ csrf_token('delete-profile') }}">
                
                <div class="form-group">
                    <label>Entrez votre mot de passe pour confirmer :</label>
                    <input type="password" name="password"  placeholder="Mot de passe">
                </div>
                
                <div class="action-buttons">
                    <button type="submit" class="btn" style="background-color: var(--danger-color);">
                        üóëÔ∏è Supprimer d√©finitivement
                    </button>
                    <button type="button" onclick="closeDeleteModal()" class="btn btn--ghost">
                        ‚ùå Annuler
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // La modale est cach√©e par d√©faut
        function openDeleteModal() {
            document.getElementById('deleteModal').style.display = 'flex';
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
        }

        // Fermer la modal si on clique en dehors
        window.onclick = function(event) {
            const modal = document.getElementById('deleteModal');
            if (event.target == modal) {
                closeDeleteModal();
            }
        }
    </script>
</div>
{% endblock %}
