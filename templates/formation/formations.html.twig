{% extends 'base.html.twig' %}

{% block title %}Formations Disponibles
{% endblock %}

{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('assets/css/medecin/dashboard.css') }}">
{% endblock %}

{% block body %}

	<div
		class="portal">

		{# Sidebar #}
		{% include 'side_bar.html.twig' %}

		<main class="portal__main">
			<div class="portal__top">
				<div>
					<h1 class="portal__title">Formations Disponibles</h1>
					<p class="portal__subtitle">Consultez et explorez toutes les formations disponibles</p>
				</div>
				<a href="{{ path('medecin_formation_new') }}" class="btn btn--primary">Cr√©er une formation</a>
			</div>

			{# Filter by category #}
			<div class="filter" style="margin-bottom: 20px;">
				<form method="get" action="{{ path('medecin_formations') }}">
					<label for="category">Filtrer par cat√©gorie :</label>
					<select name="category" id="category" onchange="this.form.submit()">
						<option value="">Toutes</option>
						{% for cat in categories %}
							<option value="{{ cat }}" {% if cat == selectedCategory %} selected {% endif %}>{{ cat }}</option>
						{% endfor %}
					</select>
				</form>
			</div>

			{% if formations is empty %}
				<div class="box">
					<p>Aucune formation disponible pour le moment.</p>
				</div>
			{% else %}
				<div class="cards">
					<div class="cards__grid">
						{% for formation in formations %}
							<div class="card">
								<h3>{{ formation.title }}</h3>
								<p>{{ formation.description|length > 100 ? formation.description|slice(0, 100) ~ '‚Ä¶' : formation.description }}</p>
								<div class="card__footer">
									<span class="pill">{{ formation.category }}</span>
									<span>{{ formation.startDate ? formation.startDate|date('d/m/Y') : '' }}
										-
										{{ formation.endDate ? formation.endDate|date('d/m/Y') : '' }}</span>
								</div>
					{% if aideSoignant %}
						{% set hasApplied = aideSoignant.formations.contains(formation) %}
						{% if hasApplied %}
							<form method="post" action="{{ path('aidesoingnant_formation_withdraw', {'id': formation.id}) }}" style="flex: 1;">
								<button type="submit" class="btn btn--secondary" style="width: 100%;">
									‚úì Candidature valid√©e
								</button>
							</form>
						{% else %}
							<form method="post" action="{{ path('aidesoingnant_formation_apply', {'id': formation.id}) }}" style="flex: 1;">
								<button type="submit" class="btn btn--primary" style="width: 100%;">
									‚úâÔ∏è Postuler
								</button>
							</form>
						{% endif %}
					{% else %}
						<a href="{{ path('medecin_formation_applicants', {'id': formation.id}) }}" class="btn btn--primary" style="flex: 1; text-align: center;">
							‚úâÔ∏è Postuler
						</a>
						<div style="margin-top: 15px; display: flex; gap: 10px;">
							<a href="{{ path('medecin_formation_applicants', {'id': formation.id}) }}" class="btn btn--secondary" style="flex: 1; text-align: center;">
								üë• View Applicants
							</a>
						</div>
					{% endif %}
							</div>
						{% endfor %}
					</div>
				</div>
			{% endif %}
		</main>
	</div>
{% endblock %}
