{% extends 'base.html.twig' %}

{% block title %}Formations Disponibles{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('assets/css/medecin/dashboard.css') }}">
    <style>
        /* Status button styles */
        .btn--success {
            background-color: #28a745;
            color: #fff;
        }
        .btn--danger {
            background-color: #dc3545;
            color: #fff;
        }
        .btn--secondary {
            background-color: #6c757d;
            color: #fff;
        }
        .card button {
            margin-top: 10px;
        }
    </style>
{% endblock %}

{% block body %}
<div class="portal">

    {% set navigation = [
        {'name': 'Dashboard', 'path': path('aidesoingnant_dashboard'), 'icon': 'üè†'},
        {'name': 'Mes Missions', 'path': path('aidesoingnant_missions'), 'icon': 'üìã'},
        {'name': 'Formation', 'path': path('aidesoingnant_formations'), 'icon': 'üìö'},
    ] %}

    {% include 'side_bar.html.twig' %}

    <main class="portal__main">

        <div class="portal__top">
            <div>
                <h1 class="portal__title">Formations Disponibles</h1>
                <p class="portal__subtitle">
                    Consultez et explorez toutes les formations disponibles
                </p>
            </div>
        </div>

        {% if formations is empty %}
            <div class="box">
                <p>Aucune formation disponible pour le moment.</p>
            </div>
        {% else %}
            <div class="cards">
                <div class="cards__grid">

                    {% for formation in formations %}
                        <div class="card" 
                             onclick="window.location='{{ path('formation_details', {'id': formation.id}) }}';" 
                             style="cursor:pointer;">

                            <h3>{{ formation.title }}</h3>

                            <p>
                                {{ formation.description|length > 100
                                    ? formation.description|slice(0, 100) ~ '‚Ä¶'
                                    : formation.description }}
                            </p>

                            <div class="card__footer">
                                <span class="pill">{{ formation.category }}</span>
                                <span>
                                    {{ formation.startDate ? formation.startDate|date('d/m/Y') : '' }}
                                    -
                                    {{ formation.endDate ? formation.endDate|date('d/m/Y') : '' }}
                                </span>
                            </div>

                            {# ================= AIDE SOIGNANT ================= #}
                            {% if current_user_type == 'aidesoignant' %}
                               {% set status = appliedFormations[formation.id]|default(null) %}

{% if status is not null %}
    {% if status == 'pending' %}
        <button class="btn btn--secondary" disabled>‚è≥ Candidature en attente</button>
    {% elseif status == 'accepted' %}
        <button class="btn btn--success" disabled>‚úÖ Candidature accept√©e</button>
    {% elseif status == 'declined' %}
        <button class="btn btn--danger" disabled>‚ùå Candidature refus√©e</button>
    {% endif %}
{% else %}
    <form method="post" action="{{ path('aidesoingnant_formation_apply', {'id': formation.id}) }}" onclick="event.stopPropagation();">
        <button type="submit" class="btn btn--primary" style="width:100%;">‚úâÔ∏è Postuler</button>
    </form>
{% endif %}
                            {% endif %}

                        </div>
                    {% endfor %}

                </div>
            </div>
        {% endif %}

    </main>
</div>
{% endblock %}